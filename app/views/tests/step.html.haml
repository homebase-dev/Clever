.page-header
  %h1
    =@question.category.name
    %small Test
    /%small #{@assignation_number+1}/#{@test.assignations.count}
.row
  .col-lg-12
    .progress
      .progress-bar.progress-bar{"aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "#{((@assignation_number+1)*100) / @test.assignations.count}", :role => "progressbar", :style => "width: #{((@assignation_number+1)*100) / @test.assignations.count}%"}
        %span #{@assignation_number+1}/#{@test.assignations.count}
    
    .panel.panel-primary
      .panel-heading
        %h3.panel-title Frage
      .panel-body
        %p=preview_html_field(@question.text)
    - @question.answers.each_with_index do |answer, index|
      %ul.list-group
        / test_step_path(:id => @test, :question_number => @question_number+2)
        = link_to "#", :onclick => "return false;", :class=> "list-group-item no-boarder" do 
          .answer{:id => "answer-#{answer.id}"}
            .answer-badge-q3
              -if @assignation.answer_checked?(answer)
                %i.fa.fa-check-square-o
              - else
                %i.fa.fa-square-o
              / %span.glyphicon.glyphicon-unchecked{"aria-hidden" => "true"}
              =answer_char(index)
              / =index_2
          .answer-text=preview_html_field(answer.text)

.row
  .col-lg-12
    - if @assignation_number > 0
      %a.btn.btn-default.pull-left{:href => test_step_path(:id => @test, :assignation_number => @assignation_number), :role => "button"} ZurÃ¼ck
    %a.btn.btn-default.pull-right{:id => 'next-link', :href => "#", :role => "button"} Weiter
    / test_step_path(:id => @test, :question_number => @question_number+2)

-if @question.category.single_question_select?
  :javascript
    $('.list-group-item').click(function() {
      var checkbox = $(this).find('i.fa');
      
      //uncheck all previous checked answers
      $(".fa-check-square-o").each(function( index ) {
        $(this).removeClass('fa-check-square-o');
        $(this).addClass('fa-square-o');
      });
      
      //check the clicked one
      if(checkbox.hasClass('fa-square-o')) {
        checkbox.removeClass('fa-square-o');
        checkbox.addClass('fa-check-square-o');
      } else {
        checkbox.addClass('fa-square-o');
        checkbox.removeClass('fa-check-square-o');
      }
      
      return false;
    });
    

    
    function getCheckedAnswersParam() {
      var checked_answer_ids= new Array();
      console.info('looking for selected');
      $(".fa-check-square-o").each(function( index ) {
        console.info( "found" );
        var id = $(this).closest('.answer').attr('id');
        checked_answer_ids.push(id);
      });
      
      var checked_answer_param = "";
      jQuery.each(checked_answer_ids, function(index, checked_answer) {
        checked_answer_param += "ca%5B%5D="+checked_answer.replace('answer-','')+"&";
      });
      
      console.info(checked_answer_ids);
      
      return checked_answer_param;
    }
    
    $('a#next-link').on('click', function() {
      var checked_answer_param = getCheckedAnswersParam();
      console.info(checked_answer_param)
      this.href = "/tests/"+"#{@test.id}"+"/step/"+"#{@assignation_number+2}?"+checked_answer_param;
    });
- else
  :javascript
    $('.list-group-item').click(function() {
      var checkbox = $(this).find('i.fa');
      
      if(checkbox.hasClass('fa-square-o')) {
        checkbox.removeClass('fa-square-o');
        checkbox.addClass('fa-check-square-o');
      } else {
        checkbox.addClass('fa-square-o');
        checkbox.removeClass('fa-check-square-o');
      }
      
      return false;
    });
    
    
    
    
    function getCheckedAnswersParam() {
      var checked_answer_ids= new Array();
      console.info('looking for selected');
      $(".fa-check-square-o").each(function( index ) {
        console.info( "found" );
        var id = $(this).closest('.answer').attr('id');
        checked_answer_ids.push(id);
      });
      
      var checked_answer_param = "";
      jQuery.each(checked_answer_ids, function(index, checked_answer) {
        checked_answer_param += "ca%5B%5D="+checked_answer.replace('answer-','')+"&";
      });
      
      console.info(checked_answer_ids);
      
      return checked_answer_param;
    }
    
    $('a#next-link').on('click', function() {
      var checked_answer_param = getCheckedAnswersParam();
      console.info(checked_answer_param)
      this.href = "/tests/"+"#{@test.id}"+"/step/"+"#{@assignation_number+2}?"+checked_answer_param;
    });

